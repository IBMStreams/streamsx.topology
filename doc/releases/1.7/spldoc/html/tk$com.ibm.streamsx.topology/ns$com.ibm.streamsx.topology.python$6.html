<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="Creating SPL Operators from Python code"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_page"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>Creating SPL Operators from Python code</title>
</head>
<body id="spldoc_page">


<h1 class="title topictitle1">Creating SPL Operators from Python code</h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">Toolkits</a> &gt; <a class="xref" href="tk$com.ibm.streamsx.topology.html">com.ibm.streamsx.topology 1.7.4</a> &gt; <a class="xref" href="ns$com.ibm.streamsx.topology.python.html">com.ibm.streamsx.topology.python</a> &gt; Creating SPL Operators from Python code</p>

</div>


<div class="section">
<p class="p">SPL operators that call a Python function or callable class are created by decorators provided by this toolkit.
</p>

<p class="p"><tt class="ph tt">bin/spl-python-extract.py</tt> is a Python script that creates SPL operators from Python functions and classes contained in modules in a toolkit. The resulting operators embed the Python runtime to allow stream processing using Python.
</p>

<p class="p">To create SPL operators from Python functions or classes one or more Python modules are created in the <tt class="ph tt">opt/python/streams</tt> directory of an SPL toolkit.
</p>

<p class="p">Each module must import the <tt class="ph tt">streamsx.spl</tt> package which is located in the <tt class="ph tt">opt/packages</tt> directory of this toolkit. It contains the decorators use to create SPL operators from Python functions. The module must also define a function <tt class="ph tt">spl_namespace</tt> that returns a string containing the SPL namespace the operators for that module will be placed in. <tt class="ph tt">splNamespace</tt> is also accepted as a function to define the SPL namespace.
</p>

<p class="p">For example:
</p>

<div class="p">
<pre class="pre codeblock">
# Import the SPL decorators
from streamsx.spl import spl

# Defines the SPL namespace for any functions in this module
# Multiple modules can map to the same namespace
def spl_namespace():
   return "com.ibm.streamsx.topology.pysamples.mail"
</pre>


</div>

<p class="p">Decorating a Python class produces a stateful SPL operator. The instance fields of the class are the state for the operator. Any parameters to the <tt class="ph tt">__init__</tt> method (exluding the first <tt class="ph tt">self</tt> parameter) are mapped to operator parameters.
</p>

<p class="p">Decorating a Python function produces a stateless SPL operator. The function may reference variables in the module that are effectively state but such variables are shared by all invocations of the operator within the same processing element.
</p>

<p class="p">Any Python docstring for the function or class is copied into the SPL operator's description field in its operator model, providing a description for IDE developers using the toolkit.
</p>

<p class="p">Functions or classes in the modules that are not decorated, decorated with <tt class="ph tt">@spl.ignore</tt> or start with <tt class="ph tt">spl</tt> are ignored and will not result in any SPL operator.
</p>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$7.html">Python classes as SPL operators</a>
</dt>
<dd class="dd">Decorating a Python class creates a stateful SPL operator where the instance fields of the class are the operator's state.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$8.html">Python functions as SPL operators</a>
</dt>
<dd class="dd">Decorating a Python function creates a stateless SPL operator.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$9.html">Dependent Python packages</a>
</dt>
<dd class="dd">The decorated Python classes and functions used for SPL operators can depend on additional Python packages or modules.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$10.html">Processing SPL tuples in Python</a>
</dt>
<dd class="dd">SPL tuples are converted to Python objects and passed to a decorated callable.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$11.html">Submission of SPL tuples from Python</a>
</dt>
<dd class="dd">The return from a decorated callable results in submission of SPL tuples on the associated outut port.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$12.html">Supported SPL types</a>
</dt>
<dd class="dd">A limited set of SPL types are supported.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$14.html">@spl decorator options</a>
</dt>
<dd class="dd">@spl decorators support an number of options.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$15.html">@spl.source</a>
</dt>
<dd class="dd">Decorator to create a stateful or stateless SPL source operator from a Python iterable class or function.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$16.html">@spl.filter</a>
</dt>
<dd class="dd">Decorator to create a stateful or stateless SPL filter operator from a Python callable class or function.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$17.html">@spl.map</a>
</dt>
<dd class="dd">Decorator to create a stateful or stateless SPL map operator from a Python callable class or function.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$18.html">@spl.for_each</a>
</dt>
<dd class="dd">Decorator to create a stateful or stateless SPL sink operator from a Python callable class or function.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$19.html">@spl.pipe</a>
</dt>
<dd class="dd">Decorator to create a stateless SPL map operator from a Python function.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$20.html">@spl.sink</a>
</dt>
<dd class="dd">Decorator to create a stateless SPL sink operator.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$21.html">@spl.ignore</a>
</dt>
<dd class="dd">Decorator to ignore a Python function.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$22.html">Extracting SPL operators from Python</a>
</dt>
<dd class="dd">Overview: To create SPL operators in a toolkit, execute: python3 spl-python-extract.py -i toolkit-directory
Any Python module in the toolkit's <tt class="ph tt">opt/python/streams</tt> directory will have its decorated classes and functions converted to SPL operators.
</dd>
</dl>

  <dl class="dl"><dt class="dt dlterm"><a class="xref" href="ns$com.ibm.streamsx.topology.python$23.html">Sample toolkit</a>
</dt>
<dd class="dd">A toolkit with a number of decorated Python functions and SPL applications that invoke them is supplied under <tt class="ph tt">samples/python/com.ibm.streamsx.topology.pysamples</tt>. Executing applications using Python: PYTHONHOME: The location of Python at runtime is defined by the environment variable <tt class="ph tt">PYTHONHOME</tt>.
</dd>
</dl>

</div>

</div>


</body>
</html>