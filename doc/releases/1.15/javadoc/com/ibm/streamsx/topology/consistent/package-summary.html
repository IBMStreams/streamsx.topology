<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0) on Fri Jun 19 09:22:23 UTC 2020 -->
<title>com.ibm.streamsx.topology.consistent (Java Application API for IBM Streams)</title>
<meta name="date" content="2020-06-19">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="com.ibm.streamsx.topology.consistent (Java Application API for IBM Streams)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div role="navigation" title ="TOP_Navigation" aria-label ="Top Navigation Bar"/>
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/ibm/streamsx/topology/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../com/ibm/streamsx/topology/context/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/ibm/streamsx/topology/consistent/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div role="main" title ="com.ibm.streamsx.topology.consistent" aria-labelledby ="Header1"/>
<div class="header">
<h1 title="Package" class="title" id="Header1">Package&nbsp;com.ibm.streamsx.topology.consistent</h1>
<div class="docSummary">
<div class="block">At least once processing using consistent regions.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/streamsx/topology/consistent/ConsistentRegionConfig.html" title="class in com.ibm.streamsx.topology.consistent">ConsistentRegionConfig</a></td>
<td class="colLast">
<div class="block">Immutable consistent region configuration.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Enum Summary table, listing enums, and an explanation">
<caption><span>Enum Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Enum</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/streamsx/topology/consistent/ConsistentRegionConfig.Trigger.html" title="enum in com.ibm.streamsx.topology.consistent">ConsistentRegionConfig.Trigger</a></td>
<td class="colLast">
<div class="block">Defines how the drain-checkpoint cycle of a consistent region is triggered.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package com.ibm.streamsx.topology.consistent Description">Package com.ibm.streamsx.topology.consistent Description</h2>
<div class="block">At least once processing using consistent regions.
 
 <H2>Consistent regions</H2>
 
 <H3>Overview</H3>
 
 Because of business requirements, some applications require that all tuples
 in an application are processed at least once. You can use a consistent
 region in your streams processing applications to avoid data loss due to
 software or hardware failure and meet your requirements for at-least-once
 processing.
 <P>
 A consistent region is a subgraph where the states region (the operators
 and transformations within it) become
 consistent by processing all the tuples within defined
 points on a stream. This enables tuples within the subgraph to be processed
 at least once. The consistent region is periodically drained of its current
 tuples. All tuples in the consistent region are processed through to the end
 of the subgraph. In-memory state of operators are automatically serialized
 and stored on checkpoint for each of the operators in the region.
 </P>
 <P>
 If any element in a consistent region fails at run time, IBM Streams detects
 the failure and triggers the restart of the element and the reset of the
 region. In-memory state of the region is automatically reloaded to
 a consistent point.
 </P>
 <P>
 The capability to drain the subgraph, which is coupled with start operators
 that can replay their output streams, enables a consistent region to achieve
 at-least-once processing.
 </P>
 <P>
 A stream processing application can be defined with zero, one, or more
 consistent regions. You can define the start of a consistent region with
 the <a href="../../../../../com/ibm/streamsx/topology/TStream.html#setConsistent-com.ibm.streamsx.topology.consistent.ConsistentRegionConfig-"><code>setConsistent()</code></a>.}.
 IBM Streams then determines
 the scope of the consistent region automatically, but you can reduce the
 scope of the region with <a href="../../../../../com/ibm/streamsx/topology/TStream.html#autonomous--"><code>TStream.autonomous()</code></a>.
 </P>
 <P>
 When a subgraph is a consistent region, IBM Streams enables the
 operators in that region to drain and reset. When a region is draining, it
 establishes logical divisions in the output streams of each operator in the
 region. A drain is successful when all operators in the region establish a
 logical division in their output streams, and when all tuples before the
 logical division are processed in their input streams. If a drain is
 successful, it means that all operators in the region consumed all input
 streams up until the established logical division. While the region is
 draining or resetting, operators in the region that completed their draining
 or resetting cannot submit new tuples. This behavior means that the tuple
 flow within the subgraph briefly stops while the region is draining or resetting.
 </P>
 
 <H3>Start of a consistent region</H3>
 A consistent region is started by marking a source stream as consistent using
 <a href="../../../../../com/ibm/streamsx/topology/TStream.html#setConsistent-com.ibm.streamsx.topology.consistent.ConsistentRegionConfig-"><code>TStream.setConsistent(ConsistentRegionConfig)</code></a>.
 The operator that is the source of the <code>TStream</code> must support logic that,
 after a failure in the region, can replay tuples since the last checkpoint.
 Typically the stream is a source stream that produces tuples from an external system
 like Apache Kakfa.
 <P>
 The logic that produces a replayable stream must be implemented
 using IBM Streams Java or C++ primitive operator apis.
 <BR>
 A functional source
 (e.g. <a href="../../../../../com/ibm/streamsx/topology/Topology.html#source-com.ibm.streamsx.topology.function.Supplier-"><code>Topology.source(com.ibm.streamsx.topology.function.Supplier)</code></a>)
 cannot be used as the start of a consistent region,
 thus the stream must be from an invocation of an SPL operator through
 <a href="../../../../../com/ibm/streamsx/topology/spl/SPL.html" title="class in com.ibm.streamsx.topology.spl"><code>SPL</code></a>, 
 <a href="../../../../../com/ibm/streamsx/topology/spl/JavaPrimitive.html" title="class in com.ibm.streamsx.topology.spl"><code>JavaPrimitive</code></a>.
 Such an invocation may be wrapped by a Java method that provides
 a simplified version of the invocation for application developers.
 </P>
 
 <H3>Drain-checkpoint cycle</H3>
 When a region is triggered it is:
 <OL>
 <LI> <em>drained</em> of any tuple related processing for
 all tuples seen on each stream in the region</li>
 <LI> <em>checkpointed</em> to reflect the state of each tuple processor (operator)
 after it has processed all tuples on its input streams (it has been <em>drained</em>).
 </OL>
 This drain-checkpoint cycle results in a region where all the operators are
 consistent with having processed all tuples seen on their input streams, and the
 region as a whole is consistent with having processed all tuples the source operator
 has submitted.
 <P>
 After any failure in the region, all operators are reset to a previous consistent point
 and then tuple processing resumes with the source operator replaying tuples since
 the last consistent point.
 </P>
 <H3>At least once/exactly once processing</H3> 
 From the point of view of an operator in the region tuple processing is effectively exactly
 once even though tuples are replayed after a failure. This is because the consistent
 region protocol resets each operator's state to a point before the tuples were seen for
 the first time. Each operator forgets it has seen the replayed tuple thus it seems them
 effectively exactly once from an operator state point of view.
 <P>
 At least once processing is only seen when the operator modifies external state that cannot
 be undone during a reset. For example sending an SMS text cannot be undone, so a IBM Streams
 application using a consistent region for monitoring and sending text alerts could result
 in more than once text message indicating an issue.
 <BR>
 With coordination between the operator and the external system exactly once processing
 is possible, depending on the capabilities of the external system, for example exactly
 once can be achieved with database and file systems.
 </P>
 <H3>Functional logic in consistent regions</H3>
 
 The checkpointing of functional logic is identical for
 consistent regions and
 <a href="../../../../../com/ibm/streamsx/topology/Topology.html#checkpointPeriod-long-java.util.concurrent.TimeUnit-"><code>autonomous checkpointing</code></a>.
 
 <H4>Stateless functions</H4>
 Stateless functions can be used in a consistent region, e.g. a stateless filter
 like <code>t = t.filter(s -&gt; !s.empty())</code> on a <code>TStream&lt;String&gt;</code>.
 During a drain-checkpoint cycle no processing occurs related to the stateless function.
  
 <H4>Stateful functions</H4>
 Stateful functions can be used in a consistent region. During a drain-checkpoint cycle
 the function instance will be serialized as the checkpointed state.
 
 <H3>Autonomous regions</H3>
 By default processing occurs in an autonomous region where
 operator checkpointing and recovery from failure is
 independent of other operators. A consistent region can be
 ended by starting an autonomous region using
 <a href="../../../../../com/ibm/streamsx/topology/TStream.html#autonomous--"><code>TStream.autonomous()</code></a>.
 Any processing against the stream returned by <code>autonomous()</code>
 is outside of the consistent region.</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div role="navigation" title ="Bottom_NAVIGATION" aria-label ="Bottom Navigation Bar"/>
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage">streamsx.topology 1.15 @ IBMStreams GitHub</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/ibm/streamsx/topology/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../com/ibm/streamsx/topology/context/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/ibm/streamsx/topology/consistent/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
